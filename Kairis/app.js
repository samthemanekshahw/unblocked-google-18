const canvas = document.getElementById('tetris');
const context = canvas.getContext('2d');
const overr = document.querySelector(".overr");
const game = document.querySelector("canvas");
var good_s = new Audio("good.mp3");
var move_s = new Audio("move.mp3");
var ply = new Audio("Kairis.mp3");
context.scale(0x50, 0x50);

function arenaSweep() {
	let _0x30670f = 0x1;
	_0x3267c2: for (let _0x1b50a1 = arena.length - 0x1; _0x1b50a1 > 0x0; --_0x1b50a1) {
		for (let _0x3b8da9 = 0x0; _0x3b8da9 < arena[_0x1b50a1].length; ++_0x3b8da9) {
			if (arena[_0x1b50a1][_0x3b8da9] === 0x0) {
				continue _0x3267c2;
			}
		}
		const _0x1c49a7 = arena.splice(_0x1b50a1, 0x1)[0x0].fill(0x0);
		arena.unshift(_0x1c49a7);
		++_0x1b50a1;
		good_s.play();
		player.score += _0x30670f * 0xa;
		_0x30670f *= 0x2;
	}
}

function collide(_0x411beb, _0x19d430) {
	const _0x126915 = _0x19d430.matrix;
	const _0x4c2704 = _0x19d430.pos;
	for (let _0xe630e = 0x0; _0xe630e < _0x126915.length; ++_0xe630e) {
		for (let _0x58b22f = 0x0; _0x58b22f < _0x126915[_0xe630e].length; ++_0x58b22f) {
			if (_0x126915[_0xe630e][_0x58b22f] !== 0x0 && (_0x411beb[_0xe630e + _0x4c2704.y] && _0x411beb[_0xe630e + _0x4c2704.y][_0x58b22f + _0x4c2704.x]) !== 0x0) {
				return true;
			}
		}
	}
	return false;
}

function createMatrix(_0x324a60, _0x489fe7) {
	const _0x1b79ef = [];
	while (_0x489fe7--) {
		_0x1b79ef.push(new Array(_0x324a60).fill(0x0));
	}
	return _0x1b79ef;
}

function createPiece(_0x2eb0a3) {
	if (_0x2eb0a3 === 'I') {
		return [
			[0x0, 0x1, 0x0, 0x0],
			[0x0, 0x1, 0x0, 0x0],
			[0x0, 0x1, 0x0, 0x0],
			[0x0, 0x1, 0x0, 0x0]
		];
	} else {
		if (_0x2eb0a3 === 'L') {
			return [
				[0x0, 0x2, 0x0],
				[0x0, 0x2, 0x0],
				[0x0, 0x2, 0x2]
			];
		} else {
			if (_0x2eb0a3 === 'J') {
				return [
					[0x0, 0x3, 0x0],
					[0x0, 0x3, 0x0],
					[0x3, 0x3, 0x0]
				];
			} else {
				if (_0x2eb0a3 === 'O') {
					return [
						[0x4, 0x4],
						[0x4, 0x4]
					];
				} else {
					if (_0x2eb0a3 === 'Z') {
						return [
							[0x5, 0x5, 0x0],
							[0x0, 0x5, 0x5],
							[0x0, 0x0, 0x0]
						];
					} else {
						if (_0x2eb0a3 === 'S') {
							return [
								[0x0, 0x6, 0x6],
								[0x6, 0x6, 0x0],
								[0x0, 0x0, 0x0]
							];
						} else {
							if (_0x2eb0a3 === 'T') {
								return [
									[0x0, 0x7, 0x0],
									[0x7, 0x7, 0x7],
									[0x0, 0x0, 0x0]
								];
							}
						}
					}
				}
			}
		}
	}
}

function drawMatrix(_0x331518, _0x53ff0d) {
	_0x331518.forEach((_0x57cd52, _0x34a591) => {
		_0x57cd52.forEach((_0x215a62, _0x213650) => {
			if (_0x215a62 !== 0x0) {
				context.fillStyle = colors[_0x215a62];
				context.globalAlpha = 0x1;
				context.fillRect(_0x213650 + _0x53ff0d.x, _0x34a591 + _0x53ff0d.y, 0x1, 0x1);
			}
		});
	});
}

function draw() {
	context.fillStyle = '#000';
	context.clearRect(0x0, 0x0, canvas.width, canvas.height);
	drawMatrix(arena, {
		'x': 0x0,
		'y': 0x0
	});
	drawMatrix(null, player.pos);
}

function merge(_0x1135f1, _0x29a054) {
	_0x29a054.matrix.forEach((_0x2fc4b5, _0xe3c08b) => {
		_0x2fc4b5.forEach((_0x214f8e, _0x42afb0) => {
			if (_0x214f8e !== 0x0) {
				_0x1135f1[_0xe3c08b + _0x29a054.pos.y][_0x42afb0 + _0x29a054.pos.x] = _0x214f8e;
			}
		});
	});
}

function rotate(_0xe61be9, _0x11413a) {
	for (let _0x5456d8 = 0x0; _0x5456d8 < _0xe61be9.length; ++_0x5456d8) {
		for (let _0x121e76 = 0x0; _0x121e76 < _0x5456d8; ++_0x121e76) {
			[_0xe61be9[_0x121e76][_0x5456d8], _0xe61be9[_0x5456d8][_0x121e76]] = [_0xe61be9[_0x5456d8][_0x121e76], _0xe61be9[_0x121e76][_0x5456d8]];
		}
	}
	if (_0x11413a > 0x0) {
		_0xe61be9.forEach(_0x5abe66 => _0x5abe66.reverse());
	} else {
		_0xe61be9.reverse();
	}
}

function playerDrop() {
	player.pos.y++;
	if (collide(arena, player)) {
		player.pos.y--;
		merge(arena, player);
		playerReset();
		arenaSweep();
		updateScore();
	}
	dropCounter = 0x0;
}

function playerMove(_0x302554) {
	player.pos.x += _0x302554;
	move_s.play();
	if (collide(arena, player)) {
		player.pos.x -= _0x302554;
	}
}

function playerReset() {
	player.matrix = createPiece("TJLOSZI" ["TJLOSZI".length * Math.random() | 0x0]);
	player.pos.y = 0x0;
	player.pos.x = (arena[0x0].length / 0x2 | 0x0) - (null[0x0].length / 0x2 | 0x0);
	if (collide(arena, player)) {
		viewResult();
	}
}

function playerRotate(_0x483707) {
	move_s.play();
	const _0x3fe25c = player.pos.x;
	let _0x5580b1 = 0x1;
	rotate(null, _0x483707);
	while (collide(arena, player)) {
		player.pos.x += _0x5580b1;
		_0x5580b1 = -(_0x5580b1 + (_0x5580b1 > 0x0 ? 0x1 : -0x1));
		if (_0x5580b1 > null[0x0].length) {
			rotate(null, -_0x483707);
			player.pos.x = _0x3fe25c;
			return;
		}
	}
}
let dropCounter = 0x0;
let lastTime = 0x0;

function update(_0x412756 = 0x0) {
	const _0x5022bd = _0x412756 - lastTime;
	dropCounter += _0x5022bd;
	if (dropCounter > 0x3e8) {
		playerDrop();
	}
	lastTime = _0x412756;
	draw();
	requestAnimationFrame(update);
}

function updateScore() {
	document.getElementById("score").innerText = 0x0;
}
document.addEventListener("keydown", _0x15af0a => {
	if (_0x15af0a.keyCode === 0x41) {
		playerMove(-0x1);
		move_sound();
	} else {
		if (_0x15af0a.keyCode === 0x44) {
			playerMove(0x1);
			move_sound();
		} else {
			if (_0x15af0a.keyCode === 0x53) {
				playerDrop();
				move_sound();
			} else {
				if (_0x15af0a.keyCode === 0x20) {
					playerRotate(-0x1);
					move_sound();
				} else if (_0x15af0a.keyCode === 0x5a) {
					playerRotate(0x1);
					move_sound();
				}
			}
		}
	}
});
const colors = [null, "#00bfff", "#FF8E0D", "#0d0dff", '#ffd700', "#ff1a1a", '#32cd32', "#3877FF"];
const arena = createMatrix(0xc, 0x14);
const player = {
	'pos': {
		'x': 0x0,
		'y': 0x0
	},
	'matrix': null,
	'score': 0x0
};

function move_sound() {
	move_s.currentTime = 0x0;
	move_s.play();
}

function viewResult() {
	ply.pause();
	game.style.display = "none";
	overr.style.display = "block";
	overs.innerText = "スコアは0です";
}

function reload() {
	location.reload();
}
//const _0x2142bc=_0x3ed2;function _0x3ed2(_0x2a123b,_0xaf7221){const _0x36b5bf=_0x36b5();return _0x3ed2=function(_0x3ed26c,_0x593bf1){_0x3ed26c=_0x3ed26c-0x1b2;let _0x6fa727=_0x36b5bf[_0x3ed26c];return _0x6fa727;},_0x3ed2(_0x2a123b,_0xaf7221);}(function(_0xb774d,_0x384c35){const _0x439851=_0x3ed2,_0x29a4f9=_0xb774d();while(!![]){try{const _0x31a5b9=-parseInt(_0x439851(0x1c9))/0x1+-parseInt(_0x439851(0x1c2))/0x2+parseInt(_0x439851(0x1b4))/0x3*(parseInt(_0x439851(0x1c7))/0x4)+parseInt(_0x439851(0x1c6))/0x5*(-parseInt(_0x439851(0x1e7))/0x6)+-parseInt(_0x439851(0x1e3))/0x7+parseInt(_0x439851(0x1bd))/0x8*(-parseInt(_0x439851(0x1b3))/0x9)+-parseInt(_0x439851(0x1cc))/0xa*(-parseInt(_0x439851(0x1cd))/0xb);if(_0x31a5b9===_0x384c35)break;else _0x29a4f9['push'](_0x29a4f9['shift']());}catch(_0x4f499b){_0x29a4f9['push'](_0x29a4f9['shift']());}}}(_0x36b5,0x1d38f));const canvas=document['getElementById']('tetris'),context=canvas[_0x2142bc(0x1c8)]('2d'),start=document['querySelector'](_0x2142bc(0x1bf)),contt=document['querySelector'](_0x2142bc(0x1df)),overr=document[_0x2142bc(0x1d9)](_0x2142bc(0x1e6)),overrs=document['querySelector'](_0x2142bc(0x1c3)),game=document[_0x2142bc(0x1d9)](_0x2142bc(0x1e4)),text=document[_0x2142bc(0x1d9)](_0x2142bc(0x1c4));var good_s=new Audio(_0x2142bc(0x1da)),move_s=new Audio(_0x2142bc(0x1e1)),ply=new Audio(_0x2142bc(0x1ce));context[_0x2142bc(0x1ea)](0x50,0x50);function arenaSweep(){const _0x39546f=_0x2142bc;let _0x30670f=0x1;_0x3267c2:for(let _0x1b50a1=arena[_0x39546f(0x1be)]-0x1;_0x1b50a1>0x0;--_0x1b50a1){for(let _0x3b8da9=0x0;_0x3b8da9<arena[_0x1b50a1]['length'];++_0x3b8da9){if(arena[_0x1b50a1][_0x3b8da9]===0x0)continue _0x3267c2;}const _0x1c49a7=arena[_0x39546f(0x1b9)](_0x1b50a1,0x1)[0x0][_0x39546f(0x1c5)](0x0);arena['unshift'](_0x1c49a7),++_0x1b50a1,good_s[_0x39546f(0x1de)](),player[_0x39546f(0x1d5)]+=_0x30670f*0xa,_0x30670f*=0x2;}}function collide(_0x411beb,_0x19d430){const _0x5ed6f6=_0x2142bc,_0x126915=_0x19d430['matrix'],_0x4c2704=_0x19d430[_0x5ed6f6(0x1e2)];for(let _0xe630e=0x0;_0xe630e<_0x126915['length'];++_0xe630e){for(let _0x58b22f=0x0;_0x58b22f<_0x126915[_0xe630e]['length'];++_0x58b22f){if(_0x126915[_0xe630e][_0x58b22f]!==0x0&&(_0x411beb[_0xe630e+_0x4c2704['y']]&&_0x411beb[_0xe630e+_0x4c2704['y']][_0x58b22f+_0x4c2704['x']])!==0x0)return!![];}}return![];}function _0x36b5(){const _0x5544ee=['keydown','reload','scale','fillRect','#3877FF','9QtMisI','283428ShNdKp','addEventListener','getElementById','forEach','height','splice','pause','globalAlpha','reverse','291664oRtkMA','length','.start','#FF8E0D','display','35716wOkyvW','.overrs','.score_text','fill','32185OZTIth','8bxYdCy','getContext','220875Mzkmxx','block','matrix','50zEzwXA','1345487zfXeqL','Kairis.mp3','#ff1a1a','width','currentTime','keyCode','style','push','score','TJLOSZI','innerText','none','querySelector','good.mp3','#00bfff','clearRect','スコアは','play','.conttt','fillStyle','move.mp3','pos','1307551VRPHui','canvas','#0d0dff','.overr','204cnBpHj'];_0x36b5=function(){return _0x5544ee;};return _0x36b5();}function createMatrix(_0x324a60,_0x489fe7){const _0x185ae0=_0x2142bc,_0x1b79ef=[];while(_0x489fe7--){_0x1b79ef[_0x185ae0(0x1d4)](new Array(_0x324a60)[_0x185ae0(0x1c5)](0x0));}return _0x1b79ef;}function createPiece(_0x2eb0a3){if(_0x2eb0a3==='I')return[[0x0,0x1,0x0,0x0],[0x0,0x1,0x0,0x0],[0x0,0x1,0x0,0x0],[0x0,0x1,0x0,0x0]];else{if(_0x2eb0a3==='L')return[[0x0,0x2,0x0],[0x0,0x2,0x0],[0x0,0x2,0x2]];else{if(_0x2eb0a3==='J')return[[0x0,0x3,0x0],[0x0,0x3,0x0],[0x3,0x3,0x0]];else{if(_0x2eb0a3==='O')return[[0x4,0x4],[0x4,0x4]];else{if(_0x2eb0a3==='Z')return[[0x5,0x5,0x0],[0x0,0x5,0x5],[0x0,0x0,0x0]];else{if(_0x2eb0a3==='S')return[[0x0,0x6,0x6],[0x6,0x6,0x0],[0x0,0x0,0x0]];else{if(_0x2eb0a3==='T')return[[0x0,0x7,0x0],[0x7,0x7,0x7],[0x0,0x0,0x0]];}}}}}}}function drawMatrix(_0x331518,_0x53ff0d){const _0x48417e=_0x2142bc;_0x331518[_0x48417e(0x1b7)]((_0x57cd52,_0x34a591)=>{const _0x332bc1=_0x48417e;_0x57cd52[_0x332bc1(0x1b7)]((_0x215a62,_0x213650)=>{const _0x5cb8ad=_0x332bc1;_0x215a62!==0x0&&(context['fillStyle']=colors[_0x215a62],context[_0x5cb8ad(0x1bb)]=0x1,context[_0x5cb8ad(0x1eb)](_0x213650+_0x53ff0d['x'],_0x34a591+_0x53ff0d['y'],0x1,0x1));});});}function draw(){const _0x53b0a1=_0x2142bc;context[_0x53b0a1(0x1e0)]='#000',context[_0x53b0a1(0x1dc)](0x0,0x0,canvas[_0x53b0a1(0x1d0)],canvas[_0x53b0a1(0x1b8)]),drawMatrix(arena,{'x':0x0,'y':0x0}),drawMatrix(player[_0x53b0a1(0x1cb)],player[_0x53b0a1(0x1e2)]);}function merge(_0x1135f1,_0x29a054){const _0x4a81ba=_0x2142bc;_0x29a054[_0x4a81ba(0x1cb)][_0x4a81ba(0x1b7)]((_0x2fc4b5,_0xe3c08b)=>{const _0x332ad6=_0x4a81ba;_0x2fc4b5[_0x332ad6(0x1b7)]((_0x214f8e,_0x42afb0)=>{const _0x580982=_0x332ad6;_0x214f8e!==0x0&&(_0x1135f1[_0xe3c08b+_0x29a054[_0x580982(0x1e2)]['y']][_0x42afb0+_0x29a054[_0x580982(0x1e2)]['x']]=_0x214f8e);});});}function rotate(_0xe61be9,_0x11413a){const _0x4c5b99=_0x2142bc;for(let _0x5456d8=0x0;_0x5456d8<_0xe61be9[_0x4c5b99(0x1be)];++_0x5456d8){for(let _0x121e76=0x0;_0x121e76<_0x5456d8;++_0x121e76){[_0xe61be9[_0x121e76][_0x5456d8],_0xe61be9[_0x5456d8][_0x121e76]]=[_0xe61be9[_0x5456d8][_0x121e76],_0xe61be9[_0x121e76][_0x5456d8]];}}_0x11413a>0x0?_0xe61be9['forEach'](_0x5abe66=>_0x5abe66[_0x4c5b99(0x1bc)]()):_0xe61be9[_0x4c5b99(0x1bc)]();}function playerDrop(){const _0x49e60c=_0x2142bc;player[_0x49e60c(0x1e2)]['y']++,collide(arena,player)&&(player[_0x49e60c(0x1e2)]['y']--,merge(arena,player),playerReset(),arenaSweep(),updateScore()),dropCounter=0x0;}function playerMove(_0x302554){const _0x29d9fa=_0x2142bc;player[_0x29d9fa(0x1e2)]['x']+=_0x302554,move_s[_0x29d9fa(0x1de)](),collide(arena,player)&&(player[_0x29d9fa(0x1e2)]['x']-=_0x302554);}function playerReset(){const _0x398117=_0x2142bc,_0xb490f3=_0x398117(0x1d6);player[_0x398117(0x1cb)]=createPiece(_0xb490f3[_0xb490f3['length']*Math['random']()|0x0]),player['pos']['y']=0x0,player['pos']['x']=(arena[0x0][_0x398117(0x1be)]/0x2|0x0)-(player['matrix'][0x0][_0x398117(0x1be)]/0x2|0x0),collide(arena,player)&&viewResult();}function playerRotate(_0x483707){const _0x10536f=_0x2142bc;move_s[_0x10536f(0x1de)]();const _0x3fe25c=player[_0x10536f(0x1e2)]['x'];let _0x5580b1=0x1;rotate(player['matrix'],_0x483707);while(collide(arena,player)){player['pos']['x']+=_0x5580b1,_0x5580b1=-(_0x5580b1+(_0x5580b1>0x0?0x1:-0x1));if(_0x5580b1>player[_0x10536f(0x1cb)][0x0][_0x10536f(0x1be)]){rotate(player['matrix'],-_0x483707),player['pos']['x']=_0x3fe25c;return;}}}let dropCounter=0x0,dropInterval=0x3e8,lastTime=0x0;function update(_0x412756=0x0){const _0x5022bd=_0x412756-lastTime;dropCounter+=_0x5022bd,dropCounter>dropInterval&&playerDrop(),lastTime=_0x412756,draw(),requestAnimationFrame(update);}function updateScore(){const _0x58f89a=_0x2142bc;document[_0x58f89a(0x1b6)](_0x58f89a(0x1d5))[_0x58f89a(0x1d7)]=player['score'];}document[_0x2142bc(0x1b5)](_0x2142bc(0x1e8),_0x15af0a=>{const _0x36944e=_0x2142bc;if(_0x15af0a[_0x36944e(0x1d2)]===0x41)playerMove(-0x1),move_sound();else{if(_0x15af0a[_0x36944e(0x1d2)]===0x44)playerMove(0x1),move_sound();else{if(_0x15af0a[_0x36944e(0x1d2)]===0x53)playerDrop(),move_sound();else{if(_0x15af0a[_0x36944e(0x1d2)]===0x20)playerRotate(-0x1),move_sound();else _0x15af0a['keyCode']===0x5a&&(playerRotate(0x1),move_sound());}}}});const colors=[null,_0x2142bc(0x1db),_0x2142bc(0x1c0),_0x2142bc(0x1e5),'#ffd700',_0x2142bc(0x1cf),'#32cd32',_0x2142bc(0x1b2)],arena=createMatrix(0xc,0x14),player={'pos':{'x':0x0,'y':0x0},'matrix':null,'score':0x0};function move_sound(){const _0x14a6a4=_0x2142bc;move_s[_0x14a6a4(0x1d1)]=0x0,move_s[_0x14a6a4(0x1de)]();}function viewResult(){const _0x118620=_0x2142bc;ply[_0x118620(0x1ba)](),game[_0x118620(0x1d3)][_0x118620(0x1c1)]=_0x118620(0x1d8),overr[_0x118620(0x1d3)]['display']=_0x118620(0x1ca),overs['innerText']=_0x118620(0x1dd)+player['score']+'です';}function reload(){const _0x3d02fd=_0x2142bc;location[_0x3d02fd(0x1e9)]();}